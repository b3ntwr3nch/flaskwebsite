{% extends "base.html" %}
{% block content %}
<style>
    .password-checker-container {
        max-width: 600px;
        margin: 2rem auto;
        padding: 2rem;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        text-align: center;
    }
    .password-input {
        width: 100%;
        max-width: 300px;
        padding: 0.5rem;
        margin: 20px auto;
        border: none;
        border-radius: 5px;
        background: rgba(255, 255, 255, 0.2);
        color: #ffffff;
    }
    .check-password-button {
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 5px;
        background: #4CAF50;
        color: white;
        cursor: pointer;
        transition: background 0.3s ease;
        margin-top: 20px;
    }
    .check-password-button:hover {
        background: #45a049;
    }
    #result {
        margin-top: 2rem;
        padding: 1rem;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 5px;
        text-align: left;
    }
    #result h2, #result h3 {
        text-align: center;
    }
    #strength-scenario {
        text-align: center;
    }
    #strength-scenario svg {
        display: block;
        margin: 20px auto;
    }
    #entropy-explanation ul {
        list-style-type: none;
        padding-left: 0;
    }
    .entropy-calculation {
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 15px;
        margin-top: 20px;
    }
    #full-result {
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 15px;
        margin-top: 20px;
        white-space: pre-wrap;
        word-break: break-all;
    }
</style>

<div class="password-checker-container">
    <h1>What If?: Password Edition</h1>
    <p>Enter your password to see how it would fare in absurd security scenarios!</p>
    <form id="password-form">
        <input type="text" class="password-input" id="password" placeholder="Enter your password">
        <button type="submit" class="check-password-button">Check Password</button>
    </form>
    <div id="result" style="display: none;">
        <h2>Password Strength Analysis</h2>
        <div id="strength-scenario"></div>
        <div id="entropy-explanation" class="mt-3">
            <h3>Password Entropy: What's That?</h3>
            <p>Imagine your password is like a fortress. Entropy is like the number of walls protecting it:</p>
            <ul>
                <li>ðŸ§± Low entropy: It's like having one thin wall. Easy for intruders!</li>
                <li>ðŸ§±ðŸ§± Medium entropy: Now we're talking! It's got a couple of sturdy walls.</li>
                <li>ðŸ§±ðŸ§±ðŸ§± High entropy: Wow! It's like a fortress with multiple thick walls all around.</li>
            </ul>
            <p>The more "walls" (entropy), the harder it is for the bad guys to break into your password fortress!</p>
            <p id="entropy-value"></p>
        </div>
        <div class="entropy-calculation">
            <h3>How is Entropy Calculated?</h3>
            <p>Imagine you're building your password fortress with different types of bricks:</p>
            <ul>
                <li>ðŸ”¤ Lowercase letters: Small bricks</li>
                <li>ðŸ”  Uppercase letters: Medium bricks</li>
                <li>ðŸ”¢ Numbers: Large bricks</li>
                <li>ðŸ”£ Special characters: Super-strong bricks</li>
            </ul>
            <p>The more types of bricks you use, and the more bricks you have, the stronger your fortress!</p>
            <p>We calculate entropy by looking at how many different types of bricks you used and how many bricks you have in total. It's like measuring the strength and size of your fortress!</p>
        </div>
        <h3>Estimated time to crack:</h3>
        <ul>
            <li>Online attack: <span id="online-crack-time"></span></li>
            <li>Offline attack (slow hash): <span id="offline-slow-crack-time"></span></li>
            <li>Offline attack (fast hash): <span id="offline-fast-crack-time"></span></li>
        </ul>
        <p id="keyboard-pattern-warning" style="display: none; color: red;">Warning: Your password contains a common keyboard pattern!</p>
        <h3>Fun Fact:</h3>
        <p id="fun-fact"></p>
        <h3>Advice:</h3>
        <ul id="advice"></ul>
        <h3>Full Result:</h3>
        <pre id="full-result"></pre>
    </div>
</div>

<script>
document.getElementById('password-form').addEventListener('submit', function(e) {
    e.preventDefault();
    var password = document.getElementById('password').value;
    console.log('Submitting password:', password);
    fetch('/password-checker', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: 'password=' + encodeURIComponent(password)
    })
    .then(response => {
        console.log('Response status:', response.status);
        return response.json();
    })
    .then(data => {
        console.log('Data received:', data);
        document.getElementById('result').innerHTML = generateWhatIfScenario(data);
        document.getElementById('result').style.display = 'block';
    })
    .catch(error => {
        console.error('Error:', error);
    });
});

function generateWhatIfScenario(data) {
    const entropyExplanation = `
        <div style="padding: 10px; border-radius: 5px; margin-bottom: 20px; background: rgba(255, 255, 255, 0.1);">
            <h3>Quick Entropy Explainer:</h3>
            <p>Imagine your password is a secret recipe. Entropy is like the number of possible ingredients and steps in that recipe. The more ingredients and steps (higher entropy), the harder it is for someone to guess your recipe. Your password's entropy is ${data.entropy.toFixed(2)} bits, which is like having a recipe with ${Math.pow(2, data.entropy).toExponential(2)} possible combinations. Now, let's see how this recipe fares in our cosmic kitchen...</p>
        </div>
    `;

    const strengthScenarios = {
        'weak': {
            title: "What if you used this password to guard Fort Knox?",
            description: `Imagine you've been tasked with guarding Fort Knox, but instead of advanced security systems, you decide to use your password as the only line of defense. Here's what would happen:

            1. Within ${data.crack_time.offline_fast}, a squirrel with a laptop would crack your code and gain entry. Yes, a squirrel.

            2. By the time you finish reading this sentence, approximately 17,283 hackers, 42 bored teenagers, and one very confused pizza delivery guy would have access to the gold vault.

            3. The entropy of your password (${data.entropy.toFixed(2)} bits) is so low that it's actually more secure to write "PLEASE DON'T STEAL" on a sticky note and slap it on the vault door.

            In conclusion, if Fort Knox were protected by this password, the U.S. economy would collapse faster than you can say "Oops". On the bright side, gold would become so common that we could finally afford those gold-plated toasters we've all been dreaming of!`
        },
        'moderate': {
            title: "What if your password was a bouncer at the world's most exclusive club?",
            description: `Let's say your password gets a job as a bouncer at "Club Entropy", the most exclusive nightclub in the known universe. Here's how the night goes:

            1. For the first ${data.crack_time.offline_slow}, your password successfully keeps out the riffraff, allowing only the most prestigious bits and bytes to enter.

            2. However, by ${data.crack_time.offline_fast}, a group of determined hackers in fancy disguises manages to sneak past.

            3. Your password's entropy (${data.entropy.toFixed(2)} bits) is like having a bouncer who's tough, but has a soft spot for anyone who can do a decent magic trick.

            In the end, Club Entropy's security is breached, but it takes long enough that most of the important data has already gone home for the night. Your password gets to keep its job, but is assigned to guard the coat check instead of the main entrance.`
        },
        'strong': {
            title: "What if your password was used to encrypt alien communications?",
            description: `Imagine that your password is chosen to encrypt all communications between Earth and a newly discovered alien civilization. Here's what unfolds:

            1. For the first ${data.crack_time.offline_slow}, our conversations about cultural exchange and the meaning of life remain perfectly secure.

            2. It would take most supercomputers ${data.crack_time.offline_fast} to crack this encryption. By that time, we've already taught the aliens about memes, and they've shared the secret to faster-than-light travel.

            3. Your password's entropy (${data.entropy.toFixed(2)} bits) is so high that some conspiracy theorists start believing it's actually an alien language itself.

            In conclusion, your password ensures that our first contact remains private long enough for humanity to get its act together. We avoid interstellar war, and the aliens are impressed enough with our encryption that they invite us to join the Galactic Federation... or at least their group chat.`
        },
        'very_strong': {
            title: "What if your password was the key to simulate our entire universe?",
            description: `In a twist of cosmic irony, it turns out your password is the exact key needed to start a simulation of our entire universe. Let's see what happens:

            1. It would take ${data.crack_time.offline_fast} to brute-force this password. By that time, our own universe might have experienced heat death.

            2. The entropy of your password (${data.entropy.toFixed(2)} bits) is so high that it could accurately simulate the position of every particle in the known universe, including that sock you lost in the dryer in 2003.

            3. Philosophers argue that since your password could simulate our universe perfectly, we might already be living in a simulation started by this very password. It's passwords all the way down!

            In the end, your password is so secure that it doesn't just protect data - it might be protecting the very fabric of our reality. Just don't use it for your social media accounts, or you might accidentally reboot the universe every time you log into Twitter.`
        }
    };

    const scenario = strengthScenarios[data.strength];

    return `
        ${entropyExplanation}
        <h2 style="text-align: center;">${scenario.title}</h2>
        <p style="white-space: pre-wrap;">${scenario.description}</p>
        <div style="padding: 10px; border-radius: 5px; margin-top: 20px; background: rgba(255, 255, 255, 0.1);">
            <p><strong>The Fun (but actually serious) Advice:</strong></p>
            <ul>
                ${data.advice.map(tip => `<li>${tip}</li>`).join('')}
            </ul>
        </div>
    `;
}

function formatJsonOutput(data) {
    let output = '';
    for (let key in data) {
        if (data.hasOwnProperty(key)) {
            output += `<strong>${key}:</strong> `;
            if (typeof data[key] === 'object' && data[key] !== null) {
                output += '<br>' + formatJsonOutput(data[key]).replace(/^/gm, '&nbsp;&nbsp;&nbsp;&nbsp;');
            } else {
                output += data[key];
            }
            output += '<br>';
        }
    }
    return output;
}
function getFortressSVG(strength, scenario) {
    const svgSize = 300;
    let svg = `<svg width="${svgSize}" height="${svgSize}" viewBox="0 0 ${svgSize} ${svgSize}">`;

    let wallCount, fortressColor, figurePosition;
    switch(strength) {
        case 'weak':
            wallCount = 1;
            fortressColor = "#ff9999";
            figurePosition = 250;
            break;
        case 'moderate':
            wallCount = 3;
            fortressColor = "#ffcc99";
            figurePosition = 200;
            break;
        case 'strong':
            wallCount = 5;
            fortressColor = "#99cc99";
            figurePosition = 150;
            break;
        case 'very_strong':
            wallCount = 7;
            fortressColor = "#9999ff";
            figurePosition = 100;
            break;
    }

    for (let i = 0; i < wallCount; i++) {
        let x = 50 + i * 30;
        svg += `<rect x="${x}" y="50" width="20" height="200" fill="${fortressColor}" stroke="black" />`;
    }

    svg += `
        <g transform="translate(${figurePosition}, 220)">
            <circle cx="0" cy="0" r="10" fill="black"/>
            <line x1="0" y1="10" x2="0" y2="30" stroke="black" stroke-width="4"/>
            <line x1="0" y1="30" x2="-10" y2="50" stroke="black" stroke-width="4"/>
            <line x1="0" y1="30" x2="10" y2="50" stroke="black" stroke-width="4"/>
            <line x1="0" y1="15" x2="-15" y2="25" stroke="black" stroke-width="4"/>
            <line x1="0" y1="15" x2="15" y2="25" stroke="black" stroke-width="4"/>
        </g>
    `;

    svg += `</svg>`;
    return `<div>${scenario}</div>${svg}`;
}
</script>
{% endblock %}