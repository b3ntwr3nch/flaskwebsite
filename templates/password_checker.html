{% extends "base.html" %}
{% block content %}
<style>
    .password-checker-container {
        max-width: 600px;
        margin: 2rem auto;
        padding: 2rem;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        text-align: center;
    }
    .password-input {
        width: 100%;
        max-width: 300px;
        padding: 0.5rem;
        margin: 20px auto;
        border: none;
        border-radius: 5px;
        background: rgba(255, 255, 255, 0.2);
        color: #ffffff;
    }
    .check-password-button {
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 5px;
        background: #4CAF50;
        color: white;
        cursor: pointer;
        transition: background 0.3s ease;
        margin-top: 20px;
    }
    .check-password-button:hover {
        background: #45a049;
    }
    #result {
        margin-top: 2rem;
        padding: 1rem;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 5px;
        text-align: left;
    }
    #result h2, #result h3 {
        text-align: center;
    }
    #strength-scenario {
        text-align: center;
    }
    #strength-scenario svg {
        display: block;
        margin: 20px auto;
    }
    #entropy-explanation ul {
        list-style-type: none;
        padding-left: 0;
    }
    .entropy-calculation {
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 15px;
        margin-top: 20px;
    }
    #full-result {
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 15px;
        margin-top: 20px;
        white-space: pre-wrap;
        word-break: break-all;
    }
</style>

<div class="password-checker-container">
    <h1>What If?: Password Edition</h1>
    <p>Enter your password to see how it would fare in absurd security scenarios!</p>
    <form id="password-form">
        <input type="text" class="password-input" id="password" placeholder="Enter your password">
        <button type="submit" class="check-password-button">Check Password</button>
    </form>
    <div id="result" style="display: none;">
        <h2>Password Strength Analysis</h2>
        <div id="strength-scenario"></div>
        <div id="entropy-explanation" class="mt-3">
            <h3>Password Entropy: What's That?</h3>
            <p>Imagine your password is like a fortress. Entropy is like the number of walls protecting it:</p>
            <ul>
                <li>ðŸ§± Low entropy: It's like having one thin wall. Easy for intruders!</li>
                <li>ðŸ§±ðŸ§± Medium entropy: Now we're talking! It's got a couple of sturdy walls.</li>
                <li>ðŸ§±ðŸ§±ðŸ§± High entropy: Wow! It's like a fortress with multiple thick walls all around.</li>
            </ul>
            <p>The more "walls" (entropy), the harder it is for the bad guys to break into your password fortress!</p>
            <p id="entropy-value"></p>
        </div>
        <div class="entropy-calculation">
            <h3>How is Entropy Calculated?</h3>
            <p>Imagine you're building your password fortress with different types of bricks:</p>
            <ul>
                <li>ðŸ”¤ Lowercase letters: Small bricks</li>
                <li>ðŸ”  Uppercase letters: Medium bricks</li>
                <li>ðŸ”¢ Numbers: Large bricks</li>
                <li>ðŸ”£ Special characters: Super-strong bricks</li>
            </ul>
            <p>The more types of bricks you use, and the more bricks you have, the stronger your fortress!</p>
            <p>We calculate entropy by looking at how many different types of bricks you used and how many bricks you have in total. It's like measuring the strength and size of your fortress!</p>
        </div>
        <h3>Estimated time to crack:</h3>
        <ul>
            <li>Online attack: <span id="online-crack-time"></span></li>
            <li>Offline attack (slow hash): <span id="offline-slow-crack-time"></span></li>
            <li>Offline attack (fast hash): <span id="offline-fast-crack-time"></span></li>
        </ul>
        <p id="keyboard-pattern-warning" style="display: none; color: red;">Warning: Your password contains a common keyboard pattern!</p>
        <h3>Fun Fact:</h3>
        <p id="fun-fact"></p>
        <h3>Advice:</h3>
        <ul id="advice"></ul>
        <h3>Full Result:</h3>
        <pre id="full-result"></pre>
    </div>
</div>

<script>
document.getElementById('password-form').addEventListener('submit', function(e) {
    e.preventDefault();
    var password = document.getElementById('password').value;
    console.log('Submitting password:', password);
    fetch('/password-checker', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: 'password=' + encodeURIComponent(password)
    })
    .then(response => {
        console.log('Response status:', response.status);
        return response.json();
    })
    .then(data => {
    console.log('Data received:', data);
    document.getElementById('strength-scenario').innerHTML = getFortressSVG(data.strength, data.scenario);
    document.getElementById('entropy-value').textContent = data.entropy_explanation;

    // Handle crack times
    const crackTimes = data.crack_time || {};
    document.getElementById('online-crack-time').textContent = crackTimes.online || 'N/A';
    document.getElementById('offline-slow-crack-time').textContent = crackTimes.offline_slow || 'N/A';
    document.getElementById('offline-fast-crack-time').textContent = crackTimes.offline_fast || 'N/A';

    document.getElementById('keyboard-pattern-warning').style.display = data.has_keyboard_pattern ? 'block' : 'none';
    document.getElementById('fun-fact').textContent = data.fun_fact || 'No fun fact available';

    // Display advice
    var adviceList = document.getElementById('advice');
    adviceList.innerHTML = '';
    if (Array.isArray(data.advice)) {
        data.advice.forEach(function(item) {
            var li = document.createElement('li');
            li.textContent = item;
            adviceList.appendChild(li);
        });
    } else {
        adviceList.innerHTML = '<li>No specific advice available</li>';
    }

    // Display full result
    var fullResultElement = document.getElementById('full-result');
    fullResultElement.innerHTML = formatJsonOutput(data);

    document.getElementById('result').style.display = 'block';
    console.log('DOM updated');
})
.catch(error => {
    console.error('Error:', error);
});

function formatJsonOutput(data) {
    let output = '';
    for (let key in data) {
        if (data.hasOwnProperty(key)) {
            output += `<strong>${key}:</strong> `;
            if (typeof data[key] === 'object' && data[key] !== null) {
                output += '<br>' + formatJsonOutput(data[key]).replace(/^/gm, '&nbsp;&nbsp;&nbsp;&nbsp;');
            } else {
                output += data[key];
            }
            output += '<br>';
        }
    }
    return output;
});

function getFortressSVG(strength, scenario) {
    const svgSize = 300;
    let svg = `<svg width="${svgSize}" height="${svgSize}" viewBox="0 0 ${svgSize} ${svgSize}">`;

    let wallCount, fortressColor, figurePosition;
    switch(strength) {
        case 'weak':
            wallCount = 1;
            fortressColor = "#ff9999"; // Light red
            figurePosition = 250;
            break;
        case 'moderate':
            wallCount = 3;
            fortressColor = "#ffcc99"; // Light orange
            figurePosition = 200;
            break;
        case 'strong':
            wallCount = 5;
            fortressColor = "#99cc99"; // Light green
            figurePosition = 150;
            break;
        case 'very_strong':
            wallCount = 7;
            fortressColor = "#9999ff"; // Light blue
            figurePosition = 100;
            break;
    }

    // Draw fortress walls
    for (let i = 0; i < wallCount; i++) {
        let x = 50 + i * 30;
        svg += `<rect x="${x}" y="50" width="20" height="200" fill="${fortressColor}" stroke="black" />`;
    }

    // Add stick figure
    svg += `
        <g transform="translate(${figurePosition}, 220)">
            <circle cx="0" cy="0" r="10" fill="black"/>
            <line x1="0" y1="10" x2="0" y2="30" stroke="black" stroke-width="4"/>
            <line x1="0" y1="30" x2="-10" y2="50" stroke="black" stroke-width="4"/>
            <line x1="0" y1="30" x2="10" y2="50" stroke="black" stroke-width="4"/>
            <line x1="0" y1="15" x2="-15" y2="25" stroke="black" stroke-width="4"/>
            <line x1="0" y1="15" x2="15" y2="25" stroke="black" stroke-width="4"/>
        </g>
    `;

    svg += `</svg>`;
    return `<div>${scenario}</div>${svg}`;
}
</script>
{% endblock %}